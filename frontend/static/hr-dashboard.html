<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>HR Assistant</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-8">

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <h1 class="text-4xl font-bold mb-8 text-gray-800">üìã –°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π</h1>

  <!-- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
  <div class="mb-6">
    <button
      hx-get="/vacancies"
      hx-target="#vacancy-list"
      hx-ext="json-enc"
      hx-swap="innerHTML"
      class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-lg rounded-xl shadow transition"
    >
      üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
    </button>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  <div id="vacancy-list" class="overflow-hidden rounded-xl shadow-lg border bg-white">
    <div class="p-6 text-gray-500">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫", —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏.</div>
  </div>

  <script>
    // –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ HTMX –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ JSON –≤ —Ç–∞–±–ª–∏—Ü—É
    htmx.defineExtension("json-enc", {
      transformResponse: function (text, xhr, elt) {
        try {
          let data = JSON.parse(text);

          if (Array.isArray(data) && data.length > 0) {
            // –ë–µ—Ä—ë–º –∫–ª—é—á–∏ –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤
            let keys = Object.keys(data[0]);

            return `
              <table class="w-full border-collapse">
                <thead>
                  <tr class="bg-gray-100 text-left text-gray-700 text-lg">
                    ${keys.map(k => <th class="p-4 border-b">${k}</th>).join("")}
                  </tr>
                </thead>
                <tbody>
                  ${data.map(v => `
                    <tr class="border-b hover:bg-gray-50 transition">
                      ${keys.map(k => {
                        let val = v[k] ?? "";
                        if (typeof val === "string" && val.match(/^\\d{4}-\\d{2}-\\d{2}/)) {
                          val = new Date(val).toLocaleDateString();
                        }
                        return <td class="p-4">${val}</td>;
                      }).join("")}
                    </tr>
                  `).join("")}
                </tbody>
              </table>
            `;
          }

          if (Array.isArray(data) && data.length === 0) {
            return <div class="p-6 text-gray-500">–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</div>;
          }

          return <pre class="p-6">${JSON.stringify(data, null, 2)}</pre>;
        } catch (e) {
          return <div class="p-6 text-red-600">–û—à–∏–±–∫–∞: ${e.message}</div>;
        }
      }
    });
  </script>

</body>
</html>