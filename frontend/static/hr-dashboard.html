<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>HR Assistant</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-8">

  <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞ -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-4xl font-bold text-gray-800">üìã –°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π</h1>
    <button
      hx-post="http://localhost:8000/auth/logout"
      hx-include-credentials="true"
      hx-target="body"
      hx-swap="innerHTML"
      class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow transition"
    >
      üö™ –í—ã–π—Ç–∏
    </button>
  </div>

  <div class="mb-6">
    <button
      hx-get="http://localhost:8000/vacancies"
      hx-target="#vacancy-list"
      hx-swap="innerHTML"
      hx-include-credentials="true"  <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û -->
      class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-lg rounded-xl shadow transition"
    >
      üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
    </button>
  </div>

  <div id="vacancy-list" class="overflow-hidden rounded-xl shadow-lg border bg-white">
    <div class="p-6 text-gray-500">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫", —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏.</div>
  </div>

  <script>
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      checkAuth();
    });

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    async function checkAuth() {
      try {
        const response = await fetch('http://localhost:8000/auth/me', {
          method: 'GET',
          credentials: 'include'  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫—É–∫–∏
        });

        if (!response.ok) {
          // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
          window.location.href = 'hr-login.html';
        }
      } catch (error) {
        window.location.href = 'hr-login.html';
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    document.body.addEventListener("htmx:beforeRequest", function(evt) {
      // –î–æ–±–∞–≤–ª—è–µ–º credentials –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º HTMX
      evt.detail.xhr.withCredentials = true;
    });

    document.body.addEventListener("htmx:responseError", function(evt) {
      if (evt.detail.xhr.status === 401) {
        // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
        window.location.href = 'hr-login.html';
      }

      document.getElementById("vacancy-list").innerHTML = `
        <div class="p-6 text-red-600">
          –û—à–∏–±–∫–∞: ${evt.detail.xhr.status} ${evt.detail.xhr.statusText}
        </div>
      `;
    });

    // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
  </script>

</body>
</html>